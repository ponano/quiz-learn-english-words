<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞: –£–≥–∞–¥–∞–π –ø–∞—Ä—É</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        .word-list {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .column {
            width: 45%;
        }
        .word {
            padding: 10px;
            margin: 5px 0;
            background-color: #fff;
            border: 1px solid #ccc;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .word:hover {
            background-color: #e0e0e0;
        }
        .selected {
            background-color: #007bff;
            color: white;
        }
        .correct {
            background-color: #28a745;
            color: white;
            pointer-events: none;
        }
        .incorrect {
            background-color: #dc3545;
            color: white;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }
        #stats {
            margin-top: 20px;
            font-size: 18px;
        }
        #progress {
            margin-top: 10px;
            font-size: 16px;
        }
        #progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            height: 20px;
            margin-top: 5px;
        }
        #progress-bar {
            height: 100%;
            background-color: #28a745;
            border-radius: 5px;
            transition: width 0.3s;
        }
        #result {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        #button-container {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #restart-button, #share-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        #restart-button:hover, #share-button:hover {
            background-color: #0056b3;
        }
        #share-button {
            display: none;
        }
        #share-message {
            margin-top: 10px;
            font-size: 14px;
            color: #28a745;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞: –£–≥–∞–¥–∞–π –ø–∞—Ä—É</h1>
        <div id="progress"></div>
        <div id="progress-bar-container">
            <div id="progress-bar" style="width: 0%;"></div>
        </div>
        <div class="word-list">
            <div class="column" id="english-words"></div>
            <div class="column" id="russian-words"></div>
        </div>
        <div id="stats"></div>
        <div id="result"></div>
        <div id="button-container">
            <button id="restart-button">–ù–∞—á–∞—Ç—å —Å –Ω–∞—á–∞–ª–∞</button>
            <button id="share-button">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</button>
        </div>
        <div id="share-message"></div>
    </div>

    <script>
        // Word pairs list with lowercase Russian translations
        const wordPairs = [
            { en: "To be", ru: "–±—ã—Ç—å" },
            { en: "To do", ru: "–¥–µ–ª–∞—Ç—å" },
            { en: "To feel", ru: "—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å" },
            { en: "To see", ru: "–≤–∏–¥–µ—Ç—å" },
            { en: "To hear", ru: "—Å–ª—ã—à–∞—Ç—å" },
            { en: "To run", ru: "–±–µ–∂–∞—Ç—å" },
            { en: "To get", ru: "–ø–æ–ª—É—á–∞—Ç—å" },
            { en: "To make", ru: "—Å–æ–∑–¥–∞–≤–∞—Ç—å" },
            { en: "To cook", ru: "–≥–æ—Ç–æ–≤–∏—Ç—å" },
            { en: "To sing", ru: "–ø–µ—Ç—å" },
            { en: "To speak", ru: "–≥–æ–≤–æ—Ä–∏—Ç—å" },
            { en: "To say", ru: "—Å–∫–∞–∑–∞—Ç—å" },
            { en: "To tell", ru: "—Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å" },
            { en: "To take", ru: "–±—Ä–∞—Ç—å" },
            { en: "To sit", ru: "—Å–∏–¥–µ—Ç—å" },
            { en: "To stand", ru: "—Å—Ç–æ—è—Ç—å" },
            { en: "To laugh", ru: "—Å–º–µ—è—Ç—å—Å—è" },
            { en: "To smile", ru: "—É–ª—ã–±–∞—Ç—å—Å—è" },
            { en: "To open", ru: "–æ—Ç–∫—Ä—ã–≤–∞—Ç—å" },
            { en: "To close", ru: "–∑–∞–∫—Ä—ã–≤–∞—Ç—å" },
            { en: "To love", ru: "–ª—é–±–∏—Ç—å" },
            { en: "To like", ru: "–Ω—Ä–∞–≤–∏—Ç—å—Å—è" },
            { en: "To give", ru: "–¥–∞–≤–∞—Ç—å" },
            { en: "To bring", ru: "–ø—Ä–∏–Ω–æ—Å–∏—Ç—å" },
            { en: "To breathe", ru: "–¥—ã—à–∞—Ç—å" },
            { en: "To buy", ru: "–ø–æ–∫—É–ø–∞—Ç—å" },
            { en: "To sell", ru: "–ø—Ä–æ–¥–∞–≤–∞—Ç—å" },
            { en: "To forget", ru: "–∑–∞–±—ã–≤–∞—Ç—å" },
            { en: "To believe", ru: "–≤–µ—Ä–∏—Ç—å" },
            { en: "To have", ru: "–∏–º–µ—Ç—å" },
            { en: "To go", ru: "–∏–¥—Ç–∏" },
            { en: "To know", ru: "–∑–Ω–∞—Ç—å" },
            { en: "To think", ru: "–¥—É–º–∞—Ç—å" },
            { en: "To come", ru: "–ø—Ä–∏—Ö–æ–¥–∏—Ç—å" },
            { en: "To want", ru: "—Ö–æ—Ç–µ—Ç—å" },
            { en: "To use", ru: "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å" },
            { en: "To find", ru: "–Ω–∞—Ö–æ–¥–∏—Ç—å" },
            { en: "To work", ru: "—Ä–∞–±–æ—Ç–∞—Ç—å" },
            { en: "To eat", ru: "–µ—Å—Ç—å" },
            { en: "To drink", ru: "–ø–∏—Ç—å" },
            { en: "To write", ru: "–ø–∏—Å–∞—Ç—å" },
            { en: "To read", ru: "—á–∏—Ç–∞—Ç—å" },
            { en: "To call", ru: "–∑–≤–æ–Ω–∏—Ç—å" },
            { en: "To try", ru: "–ø—ã—Ç–∞—Ç—å—Å—è" },
            { en: "To need", ru: "–Ω—É–∂–¥–∞—Ç—å—Å—è" },
            { en: "To become", ru: "—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è" },
            { en: "To put", ru: "–∫–ª–∞—Å—Ç—å" },
            { en: "To leave", ru: "—É—Ö–æ–¥–∏—Ç—å" },
            { en: "To pay", ru: "–ø–ª–∞—Ç–∏—Ç—å" },
            { en: "To play", ru: "–∏–≥—Ä–∞—Ç—å" },
            { en: "To pray", ru: "–º–æ–ª–∏—Ç—å—Å—è" },
            { en: "To stay", ru: "–æ—Å—Ç–∞–≤–∞—Ç—å—Å—è" },
            { en: "To mean", ru: "–æ–∑–Ω–∞—á–∞—Ç—å" },
            { en: "To keep", ru: "–¥–µ—Ä–∂–∞—Ç—å" },
            { en: "To let", ru: "–ø–æ–∑–≤–æ–ª—è—Ç—å" },
            { en: "To begin", ru: "–Ω–∞—á–∏–Ω–∞—Ç—å" },
            { en: "To start", ru: "–∑–∞–ø—É—Å–∫–∞—Ç—å" },
            { en: "To finish", ru: "–∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å" },
            { en: "To help", ru: "–ø–æ–º–æ–≥–∞—Ç—å" },
            { en: "To show", ru: "–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å" },
            { en: "To cry", ru: "–ø–ª–∞–∫–∞—Ç—å" },
            { en: "To move", ru: "–¥–≤–∏–≥–∞—Ç—å—Å—è" },
            { en: "To jump", ru: "–ø—Ä—ã–≥–∞—Ç—å" },
            { en: "To live", ru: "–∂–∏—Ç—å" },
            { en: "To die", ru: "—É–º–∏—Ä–∞—Ç—å" },
            { en: "To happen", ru: "–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å" },
            { en: "To lose", ru: "—Ç–µ—Ä—è—Ç—å" },
            { en: "To hate", ru: "–Ω–µ–Ω–∞–≤–∏–¥–µ—Ç—å" },
            { en: "To include", ru: "–≤–∫–ª—é—á–∞—Ç—å" },
            { en: "To turn on", ru: "–≤–∫–ª—é—á–∞—Ç—å" },
            { en: "To turn off", ru: "–≤—ã–∫–ª—é—á–∞—Ç—å" },
            { en: "To continue", ru: "–ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å" },
            { en: "To change", ru: "–º–µ–Ω—è—Ç—å" },
            { en: "To wash", ru: "–º—ã—Ç—å" },
            { en: "To clean", ru: "—á–∏—Å—Ç–∏—Ç—å" },
            { en: "To lead", ru: "–≤–µ—Å—Ç–∏" },
            { en: "To understand", ru: "–ø–æ–Ω–∏–º–∞—Ç—å" },
            { en: "To watch", ru: "—Å–º–æ—Ç—Ä–µ—Ç—å" },
            { en: "To discover", ru: "–æ—Ç–∫—Ä—ã–≤–∞—Ç—å" },
            { en: "To imagine", ru: "–≤–æ–æ–±—Ä–∞–∂–∞—Ç—å" },
            { en: "To introduce", ru: "–ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å" },
            { en: "To follow", ru: "—Å–ª–µ–¥–æ–≤–∞—Ç—å" },
            { en: "To create", ru: "—Å–æ–∑–¥–∞–≤–∞—Ç—å" },
            { en: "To grow", ru: "—Ä–∞—Å—Ç–∏" },
            { en: "To spend", ru: "—Ç—Ä–∞—Ç–∏—Ç—å" },
            { en: "To win", ru: "–ø–æ–±–µ–∂–¥–∞—Ç—å" },
            { en: "To offer", ru: "–ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å" },
            { en: "To learn", ru: "—É—á–∏—Ç—å—Å—è" },
            { en: "To appear", ru: "–ø–æ—è–≤–ª—è—Ç—å—Å—è" },
            { en: "To disappear", ru: "–∏—Å—á–µ–∑–∞—Ç—å" },
            { en: "To build", ru: "—Å—Ç—Ä–æ–∏—Ç—å" },
            { en: "To break", ru: "–ª–æ–º–∞—Ç—å" },
            { en: "To send", ru: "–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å" },
            { en: "To fall", ru: "–ø–∞–¥–∞—Ç—å" },
            { en: "To cut", ru: "—Ä–µ–∑–∞—Ç—å" },
            { en: "To achieve", ru: "–¥–æ—Å—Ç–∏–≥–∞—Ç—å" },
            { en: "To communicate", ru: "–æ–±—â–∞—Ç—å—Å—è" },
            { en: "To kill", ru: "—É–±–∏–≤–∞—Ç—å" },
            { en: "To pass", ru: "–ø—Ä–æ—Ö–æ–¥–∏—Ç—å" },
            { en: "To fly", ru: "–ª–µ—Ç–∞—Ç—å" },
            { en: "To swim", ru: "–ø–ª–∞–≤–∞—Ç—å" },
            { en: "To decide", ru: "—Ä–µ—à–∞—Ç—å" },
            { en: "To return", ru: "–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è" },
            { en: "To hope", ru: "–Ω–∞–¥–µ—è—Ç—å—Å—è" },
            { en: "To explain", ru: "–æ–±—ä—è—Å–Ω—è—Ç—å" },
            { en: "To propose", ru: "–ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å" },
            { en: "To develop", ru: "—Ä–∞–∑–≤–∏–≤–∞—Ç—å" },
            { en: "To support", ru: "–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å" },
            { en: "To dance", ru: "—Ç–∞–Ω—Ü–µ–≤–∞—Ç—å" },
            { en: "To draw", ru: "—Ä–∏—Å–æ–≤–∞—Ç—å" },
            { en: "To book", ru: "–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" },
            { en: "To be afraid", ru: "–±–æ—è—Ç—å—Å—è" },
            { en: "To agree", ru: "—Å–æ–≥–ª–∞—à–∞—Ç—å—Å—è" },
            { en: "To check up", ru: "–ø—Ä–æ–≤–µ—Ä—è—Ç—å" },
            { en: "To delete", ru: "—É–¥–∞–ª—è—Ç—å" },
            { en: "To choose", ru: "–≤—ã–±–∏—Ä–∞—Ç—å" },
            { en: "To catch", ru: "–ª–æ–≤–∏—Ç—å" },
            { en: "To ask", ru: "—Å–ø—Ä–∞—à–∏–≤–∞—Ç—å" },
            { en: "To answer", ru: "–æ—Ç–≤–µ—á–∞—Ç—å" },
            { en: "To hesitate", ru: "–∫–æ–ª–µ–±–∞—Ç—å—Å—è" }
        ];

        // Quiz state variables
        let currentBatch = 0;
        const batchSize = 10; // 10 pairs per page
        let selectedEn = null;
        let selectedRu = null;
        let correctAnswers = 0;
        let totalAttempts = 0;
        let matchedPairs = [];
        let batchAttempts = 0; // Counter for attempts in the current batch
        let batches = []; // Store precomputed batches
        const totalWords = wordPairs.length; // Total number of words (116)

        // Create batches with unique Russian translations
        function createBatches() {
            try {
                batches = [];
                const shuffledPairs = shuffle([...wordPairs]);
                for (let i = 0; i < shuffledPairs.length; i += batchSize) {
                    const batch = shuffledPairs.slice(i, i + batchSize);
                    // Ensure unique Russian translations in each batch
                    const uniqueBatch = [];
                    const usedTranslations = new Set();
                    for (const pair of batch) {
                        if (!usedTranslations.has(pair.ru)) {
                            uniqueBatch.push(pair);
                            usedTranslations.add(pair.ru);
                        }
                    }
                    if (uniqueBatch.length > 0) {
                        batches.push(uniqueBatch);
                    }
                }
                console.log("Created batches:", batches); // Debug log
                if (batches.length === 0) {
                    console.error("No batches created");
                }
            } catch (error) {
                console.error("Error in createBatches:", error);
            }
        }

        // Shuffle array function
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Share result function
        function shareResult() {
            const percentage = totalAttempts > 0 ? ((correctAnswers / totalAttempts) * 100).toFixed(2) : 0;
            const shareText = percentage >= 95
                ? `–Ø –ø—Ä–æ—à–µ–ª –≤–∏–∫—Ç–æ—Ä–∏–Ω—É "–£–≥–∞–¥–∞–π –ø–∞—Ä—É" —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º ${percentage}% (${correctAnswers} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–∑ ${totalAttempts} –ø–æ–ø—ã—Ç–æ–∫)! üéâ`
                : `–Ø –∑–∞–≤–µ—Ä—à–∏–ª –≤–∏–∫—Ç–æ—Ä–∏–Ω—É "–£–≥–∞–¥–∞–π –ø–∞—Ä—É" —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º ${percentage}% (${correctAnswers} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–∑ ${totalAttempts} –ø–æ–ø—ã—Ç–æ–∫). –ù—É–∂–Ω–æ 95% –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è!`;

            if (navigator.share) {
                navigator.share({
                    title: '–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã "–£–≥–∞–¥–∞–π –ø–∞—Ä—É"',
                    text: shareText,
                    url: window.location.href
                }).catch(err => {
                    console.error("Error sharing:", err);
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const shareMessage = document.getElementById('share-message');
                if (shareMessage) {
                    shareMessage.textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!';
                    shareMessage.style.display = 'block';
                    setTimeout(() => {
                        shareMessage.style.display = 'none';
                    }, 2000);
                }
            }).catch(err => {
                console.error("Error copying to clipboard:", err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: ' + text);
            });
        }

        // Restart quiz function with confirmation
        function restartQuiz() {
            console.log("Restart button clicked"); // Debug log
            // Use confirm, fallback to alert for testing
            const confirmed = window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ? –ü—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.") || 
                             (alert("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å."), window.confirm("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–±—Ä–æ—Å"));
            console.log("Confirm result:", confirmed); // Debug log
            if (confirmed) {
                console.log("Restarting quiz..."); // Debug log
                // Reset state
                currentBatch = 0;
                selectedEn = null;
                selectedRu = null;
                correctAnswers = 0;
                totalAttempts = 0;
                matchedPairs = [];
                batchAttempts = 0;
                batches = [];
                console.log("State reset:", { currentBatch, correctAnswers, totalAttempts }); // Debug log

                // Clear DOM elements individually
                const elements = {
                    englishWords: document.getElementById('english-words'),
                    russianWords: document.getElementById('russian-words'),
                    stats: document.getElementById('stats'),
                    result: document.getElementById('result'),
                    shareButton: document.getElementById('share-button'),
                    shareMessage: document.getElementById('share-message')
                };
                if (elements.englishWords) elements.englishWords.innerHTML = '';
                if (elements.russianWords) elements.russianWords.innerHTML = '';
                if (elements.stats) elements.stats.textContent = '';
                if (elements.result) elements.result.textContent = '';
                if (elements.shareButton) elements.shareButton.style.display = 'none';
                if (elements.shareMessage) elements.shareMessage.style.display = 'none';
                if (elements.englishWords) elements.englishWords.classList.remove('disabled');
                if (elements.russianWords) elements.russianWords.classList.remove('disabled');
                
                if (Object.values(elements).every(el => el)) {
                    console.log("DOM cleared"); // Debug log
                } else {
                    console.error("One or more DOM elements not found during restart:", 
                        Object.keys(elements).filter(key => !elements[key]));
                }

                try {
                    createBatches();
                    console.log("Batches created"); // Debug log
                    displayBatch();
                    console.log("New batch displayed"); // Debug log
                } catch (error) {
                    console.error("Error during restart:", error);
                }
            } else {
                console.log("Restart cancelled"); // Debug log
            }
        }

        // Update progress bar and text
        function updateProgress() {
            const progressElement = document.getElementById('progress');
            const progressBar = document.getElementById('progress-bar');
            if (progressElement && progressBar) {
                const totalBatches = batches.length || 1; // Prevent division by zero
                const progressPercentage = totalAttempts > 0 ? ((totalAttempts / totalWords) * 100).toFixed(2) : 0;
                progressElement.textContent = `–õ–∏—Å—Ç ${currentBatch + 1} –∏–∑ ${totalBatches} | –ü—Ä–æ–π–¥–µ–Ω–æ ${totalAttempts}/${totalWords} —Å–ª–æ–≤`;
                progressBar.style.width = `${progressPercentage}%`;
            } else {
                console.error("Progress elements not found");
            }
        }

        // Display current batch of words
        function displayBatch() {
            const englishWords = document.getElementById('english-words');
            const russianWords = document.getElementById('russian-words');
            if (!englishWords || !russianWords) {
                console.error("DOM elements 'english-words' or 'russian-words' not found");
                return;
            }
            englishWords.innerHTML = '';
            russianWords.innerHTML = '';
            batchAttempts = 0; // Reset batch attempts counter

            if (batches.length === 0) {
                createBatches();
            }

            if (currentBatch >= batches.length) {
                console.error("No more batches to display");
                checkQuizCompletion();
                return;
            }

            const currentPairs = batches[currentBatch];
            console.log(`Displaying batch ${currentBatch + 1}:`, currentPairs); // Debug log

            if (!currentPairs || currentPairs.length === 0) {
                console.error("No pairs to display in current batch");
                return;
            }

            const shuffledRu = shuffle([...currentPairs]);

            currentPairs.forEach(pair => {
                const enDiv = document.createElement('div');
                enDiv.classList.add('word');
                enDiv.textContent = pair.en.replace(/^To\s/, '');
                enDiv.dataset.word = pair.en; // Keep original for matching
                enDiv.addEventListener('click', () => selectWord(enDiv, 'en'));
                englishWords.appendChild(enDiv);
            });

            shuffledRu.forEach(pair => {
                const ruDiv = document.createElement('div');
                ruDiv.classList.add('word');
                ruDiv.textContent = pair.ru;
                ruDiv.dataset.word = pair.en; // Use original English word for matching
                ruDiv.addEventListener('click', () => selectWord(ruDiv, 'ru'));
                russianWords.appendChild(ruDiv);
            });

            updateStats();
            updateProgress();
        }

        // Handle word selection
        function selectWord(element, type) {
            if (element.classList.contains('correct')) return; // Cannot select already correct word

            if (type === 'en') {
                if (element === selectedEn) {
                    // Deselect if clicked again
                    element.classList.remove('selected');
                    selectedEn = null;
                } else {
                    if (selectedEn) selectedEn.classList.remove('selected');
                    selectedEn = element;
                    selectedEn.classList.add('selected');
                }
            } else {
                if (element === selectedRu) {
                    // Deselect if clicked again
                    element.classList.remove('selected');
                    selectedRu = null;
                } else {
                    if (selectedRu) selectedRu.classList.remove('selected');
                    selectedRu = element;
                    selectedRu.classList.add('selected');
                }
            }

            if (selectedEn && selectedRu) {
                checkPair();
            }
        }

        // Check selected pair
        function checkPair() {
            totalAttempts++;
            batchAttempts++;
            const isCorrect = selectedEn && selectedRu && selectedEn.dataset.word === selectedRu.dataset.word;

            if (isCorrect) {
                selectedEn.classList.add('correct');
                selectedRu.classList.add('correct');
                selectedEn.classList.remove('selected');
                selectedRu.classList.remove('selected');
                correctAnswers++;
                matchedPairs.push(selectedEn.dataset.word);
            } else {
                selectedEn.classList.add('incorrect');
                selectedRu.classList.add('incorrect');
                selectedEn.classList.remove('selected');
                selectedRu.classList.remove('selected');
                setTimeout(() => {
                    if (selectedEn && !selectedEn.classList.contains('correct')) selectedEn.classList.remove('incorrect');
                    if (selectedRu && !selectedRu.classList.contains('correct')) selectedRu.classList.remove('incorrect');
                }, 1000);
            }

            selectedEn = null;
            selectedRu = null;

            updateStats();
            updateProgress();

            // Check if current batch is complete
            const currentBatchSize = batches[currentBatch]?.length || 0;
            if (batchAttempts >= currentBatchSize) {
                if (currentBatch + 1 < batches.length) {
                    currentBatch++;
                    displayBatch();
                } else {
                    checkQuizCompletion();
                }
            }
        }

        // Update statistics
        function updateStats() {
            const statsElement = document.getElementById('stats');
            if (statsElement) {
                const percentage = totalAttempts > 0 ? ((correctAnswers / totalAttempts) * 100).toFixed(2) : 0;
                statsElement.textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correctAnswers} –∏–∑ ${totalAttempts} (${percentage}%)`;
            } else {
                console.error("Stats element not found");
            }
        }

        // Check quiz completion
        function checkQuizCompletion() {
            const percentage = totalAttempts > 0 ? ((correctAnswers / totalAttempts) * 100).toFixed(2) : 0;
            const resultElement = document.getElementById('result');
            const shareButton = document.getElementById('share-button');
            if (resultElement && shareButton) {
                if (percentage >= 95) {
                    resultElement.textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É —Å ${percentage}% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!`;
                    document.getElementById('english-words')?.classList.add('disabled');
                    document.getElementById('russian-words')?.classList.add('disabled');
                } else {
                    resultElement.textContent = `–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${percentage}%. –ù—É–∂–Ω–æ 95% –∏–ª–∏ –≤—ã—à–µ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.`;
                }
                shareButton.style.display = 'block';
                shareButton.removeEventListener('click', shareResult); // Prevent duplicate listeners
                shareButton.addEventListener('click', shareResult);
            } else {
                console.error("Result or share button element not found");
            }
        }

        // Initialize quiz
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM fully loaded"); // Debug log
            const restartButton = document.getElementById('restart-button');
            if (restartButton) {
                console.log("Restart button found, adding event listener"); // Debug log
                restartButton.removeEventListener('click', restartQuiz); // Prevent duplicate listeners
                restartButton.addEventListener('click', restartQuiz);
            } else {
                console.error("Restart button not found in DOM");
                // Retry after a delay
                setTimeout(() => {
                    const retryButton = document.getElementById('restart-button');
                    if (retryButton) {
                        console.log("Retry: Restart button found, adding event listener");
                        retryButton.removeEventListener('click', restartQuiz);
                        retryButton.addEventListener('click', restartQuiz);
                    } else {
                        console.error("Retry: Restart button still not found");
                    }
                }, 1000);
            }
            try {
                console.log("Initializing quiz..."); // Debug log
                createBatches();
                displayBatch();
            } catch (error) {
                console.error("Error initializing quiz:", error);
            }
        });
    </script>
</body>
</html>